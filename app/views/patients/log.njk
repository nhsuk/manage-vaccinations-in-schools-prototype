{% extends "_layouts/default.njk" %}

{% set view = "log" %}
{% set title = patient.record.fullName + " â€“ Activity log" %}

{% block content %}
  <div class="nhsuk-u-width-three-quarters">
    {{ super() }}

    {{ heading({
      title: patient.record.fullName
    }) }}

    {% include "patients/_secondary-navigation.njk" %}

    <h2 class="nhsuk-heading-m">Activity log</h2>

    {% for formattedDate, events in log | groupby("formattedDate") %}
      <h3 class="nhsuk-heading-xs nhsuk-u-secondary-text-color nhsuk-u-font-weight-normal">{{ formattedDate }}</h3>

      {% for event in events %}
        {% set eventDescriptionHtml %}
          {{ insetText({
            classes: "nhsuk-u-margin-top-0 nhsuk-u-margin-bottom-4",
            HTML: event.note | nhsukMarkdown
          }) if event.note }}
          <p class="nhsuk-body-s nhsuk-u-margin-0 nhsuk-u-secondary-text-color">
            {{ event.date | govukDateTime }}
            {% if event.user %}&middot;
              {{ link(event.user.uri, event.user.fullNameWithRegistration) | safe }}
            {% endif %}
          </p>
        {% endset %}

        {{ card({
          heading: event.name,
          headingClasses: "nhsuk-heading-s",
          description: eventDescriptionHtml,
          attributes: {
            id: event.uuid
          }
        }) }}
      {% endfor %}
    {% endfor %}
  </div>
{% endblock %}
