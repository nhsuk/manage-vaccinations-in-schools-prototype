{% from "govuk/components/file-upload/macro.njk" import govukFileUpload %}

{% extends "_layouts/form.njk" %}

{% set confirmButtonText = __("import.file.confirm") %}
{% set title = __("import.file.title", { type: _import.type | lower }) %}

{% set templateFormat %}
  {% include "import/form/_template-format.njk" %}
{% endset %}

{% block form %}
  {{ errorSummary({
    titleText: __("error.title"),
    errorList: errorList(errors)
  }) if errors }}

  {% if import.type == ImportType.Report %}
    {% if programme.type == ProgrammeType.Flu %}
      {% set hintText = __("import.file.hint", {
        type: import.type | lower,
        prefix: "These will go to NHS England and GPs. "
      }) %}
    {% elif programme.type == ProgrammeType.HPV %}
      {% set hintText = __("import.file.hint", {
        type: import.type | lower,
        prefix: "These will go to NHS England. "
      }) %}
    {% else %}
      {% set hintText = __("import.file.hint", {
        type: import.type | lower
      }) %}
    {% endif %}
  {% else %}
    {% set hintText = __("import.file.hint", {
      type: import.type | lower
    }) %}
  {% endif %}

  {{ govukFileUpload({
    id: "import",
    name: "import",
    label: {
      classes: "nhsuk-label--m",
      html: heading({
        caption: programme.name,
        title: title
      })
    },
    hint: {
      text: hintText
    },
    errorMessage: {
      text: errors.import
    } if errors.import
  }) | replace("govuk-", "nhsuk-") }}

  {{ details({
    text: __("import.file.format"),
    HTML: templateFormat
  }) if _import.type == ImportType.Cohort }}

  {{ radios({
    formGroup: {
      classes: "app-prototype"
    },
    fieldset: {
      legend: {
        classes: "nhsuk-fieldset__legend--m",
        text: "Select an import scenario"
      }
    },
    items: [{
      text: "File not in the correct format",
      value: "invalid"
    }, {
      text: "File contains records with validation errors",
      value: "errors"
    }, {
      text: __("import.new.check-answers.issues"),
      value: "happy"
    }],
    decorate: "scenario"
  }) }}
{% endblock %}
