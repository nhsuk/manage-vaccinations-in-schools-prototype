{% extends "_layouts/form.njk" %}

{% set confirmButtonText = __("import.file.title", {
  type: import.type | lower
}) %}
{% set gridColumns = "full" %}
{% set title = __("import.new.check-answers.title") %}

{% block form %}
  {{ heading({
    caption: programme.name,
    title: title
  }) }}

  {{ warningCallout({
    heading: __("import.new.check-answers.issues"),
    HTML: issues
  }) if issues }}

  {{ button({
    text: confirmButtonText
  }) }}

  {% set duplicateRecordRows = [] %}
  {% for record in duplicates %}
    {% set duplicateRecordRows = duplicateRecordRows | push([
      {
        header: __("record.fullName.label"),
        html: record.fullName
      },
      {
        header: __("import.issue.label"),
        html: __("import.issue.text")
      },
      {
        header: __("import.actions.label"),
        html: actionList({
          items: [{
            text: "Review",
            href: import.uri + "/review/" + record.nhsn + "?referrer=" + import.uri + "/new/check-answers"
          }]
        })
      }
    ]) %}
  {% endfor %}

  {{ actionTable({
    id: "duplicate-records",
    sort: "name",
    panel: true,
    heading: __n("import.duplicate.count", import.duplicate),
    responsive: true,
    head: [
      {
        text: __("record.label"),
        attributes: { "no-sort": "no-sort" }
      },
      {
        text: __("import.issue.label"),
        attributes: { "no-sort": "no-sort" }
      },
      {
        text: __("import.actions.label"),
        attributes: { "no-sort": "no-sort" }
      }
    ],
    rows: duplicateRecordRows
  }) if import.duplicate }}

  {% set recordRows = [] %}
  {% for record in import.records %}
    {% set recordRows = recordRows | push([
      {
        header: __("record.fullName.label"),
        text: record.fullName
      },
      {
        header: __("record.nhsn.label"),
        html: record.formatted.nhsn or "Not provided"
      },
      {
        header: __("record.dob.label"),
        html: record.formatted.dob
      },
      {
        header: __("record.postalCode.label"),
        text: record.postalCode
      } if import.type == ImportType.Cohort, {
        header: __("vaccination.created.label"),
        text: record.vaccination.formatted.created_date
      } if import.type == ImportType.Report,
      {
        header: __("import.actions.label"),
        html: actionList({
          items: [{
            text: "Edit",
            href: "#"
          }]
        })
      }
    ]) %}
  {% endfor %}

  {{ actionTable({
    id: "records",
    sort: "name",
    panel: true,
    heading: __n("import.new.count", import.records.length),
    responsive: true,
    head: [
      { text: __("record.fullName.label") },
      { text: __("record.nhsn.label") },
      { text: __("record.dob.label") },
      { text: __("record.postalCode.label") } if import.type == ImportType.Cohort,
      { text: __("vaccination.created.label") } if import.type == ImportType.Report,
      {
        text: __("import.actions.label"),
        attributes: {
          "no-sort": "no-sort"
        }
      }
    ],
    rows: recordRows
  }) }}
{% endblock %}
