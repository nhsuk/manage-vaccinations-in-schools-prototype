{% from "patient/_navigation.njk" import patientNavigation with context %}

{% extends "_layouts/default.njk" %}

{% set title = patient.fullName + " â€“ " + __("patient.events.title") %}

{% block beforeContent %}
  {{ breadcrumb({
    items: [{
      text: __("home.show.title"),
      href: "/"
    }, {
      text: __("patient.list.title"),
      href: "/patients"
    }]
  }) }}
{% endblock %}

{% block content %}
  <div class="nhsuk-u-width-three-quarters">
    {{ super() }}

    {{ patientNavigation({
      patient: patient
    }) }}

    {% set sessionsDescriptionHtml %}
      {% if programmePatientSessions.length %}
        {% set patientSessionRows = [] %}
        {% for patientSession in programmePatientSessions %}
          {% set patientSessionRows = patientSessionRows | push([
            {
              header: __("session.location.label"),
              html: link(patientSession.uri, patientSession.session.location.name)
            },
            {
              header: __("session.dates.label"),
              html: patientSession.session.formatted.dates if patientSession.session.dates.length else patientSession.session.status
            },
            {
              header: "Status",
              html: patientSession.formatted.status.report
            }
          ]) %}
        {% endfor %}

        {{ table({
          id: "patient-sessions",
          sort: "name",
          responsive: true,
          head: [
            { text: __("session.location.label") },
            { text: __("session.dates.label") },
            { text: "Status" }
          ],
          rows: patientSessionRows
        }) }}
      {% else %}
        {{ __n("session.count", 0) | nhsukMarkdown }}
      {% endif %}
    {% endset %}

    {{ card({
      heading: __("session.label"),
      headingLevel: 3,
      descriptionHtml: sessionsDescriptionHtml
    }) if programmePatientSessions.length }}

    {{ card({
      heading: "Activity",
      headingLevel: 3,
      descriptionHtml: nhsappTimeline({
        items: timelineItems(programmeAuditEvents)
      })
    }) if programmeAuditEvents.length }}
  </div>
{% endblock %}
