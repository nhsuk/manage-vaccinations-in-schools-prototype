{% extends "_layouts/session.njk" %}

{% set title = patient.initials + " – " + session.location.name %}
{% set heading = patientSession.patient.fullName %}

{% block beforeContent %}
  {{ breadcrumb({
    classes: "nhsuk-breadcrumb--reverse",
    items: [{
      text: session.name,
      href: session.uri
    }, {
      text: __("session." + activity + ".label"),
      href: session.uri + "/" + activity
    } if activity]
  }) }}
{% endblock %}

{% block content %}
  {{ super() }}

  <div class="nhsuk-grid-row">
    <div class="app-grid-column-patient-record" data-module="app-sticky">
      {{ summaryList({
        card: {
          heading: patientSession.patient.fullName,
          headingClasses: "nhsuk-u-margin-bottom-2",
          headingLevel: 3,
          headingSize: "s",
          href: patient.uri + "?referrer=" + referrer,
          secondary: true
        },
        classes: "nhsuk-summary-list--no-border app-summary-list--full-width",
        rows: summaryRows(patient, {
          nhsn: {
            changeLabel: "the child’s NHS number",
            href: patient.uri + "/edit/nhsn" if patient.hasMissingNhsNumber
          },
          dob: {},
          impairments: {},
          adjustments: {},
          address: {}
        })
      }) }}

      {{ link(patient.uri + "/programmes/" + programme.id + "?referrer=" + referrer, __("patientSession.patientProgramme.label", programme.nameSentenceCase)) | nhsukMarkdown }}
    </div>

    <div class="app-grid-column-patient-session">
      {{ warningCallout({
        classes: "nhsuk-u-margin-top-3",
        heading: __mf("patientSession.outstandingVaccinations.label", {
          count: patientSession.outstandingVaccinations.length
        }),
        text: __mf("patientSession.outstandingVaccinations.message", {
          count: patientSession.outstandingVaccinations.length,
          names: patientSession.formatted.outstandingVaccinations
        })
      }) if options.showOutstandingVaccinations }}

      {% include "patient-session/_report.njk" %}

      {% for auditEvent in patientSession.pinnedNotes %}
        {{ card({
          classes: "nhsuk-u-margin-top-2 app-card--orange",
          heading: auditEvent.name,
          headingLevel: 3,
          descriptionHtml: appEvent({ auditEvent: auditEvent, showProgrammes: true })
        }) }}
      {% endfor %}

      {% if options.canGillick or patientSession.gillick %}
        {% include "patient-session/_gillick.njk" %}
      {% endif %}

      {% if options.canTriage %}
        {% include "patient-session/_triage.njk" %}
      {% endif %}

      {% if options.hasInstruct %}
        {% include "patient-session/_instruct.njk" %}
      {% endif %}

      {% if options.canRegister %}
        {% include "patient-session/_register.njk" %}
      {% endif %}

      {% if options.canRecord %}
        {% include "patient-session/_record.njk" %}
      {% elif options.canRecordPrevious %}
        {% include "patient-session/_record-previous.njk" %}
      {% endif %}
    </div>
  </div>
{% endblock %}
