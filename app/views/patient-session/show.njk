{% extends "_layouts/session.njk" %}

{% set title = patient.initials + " – " + session.location.name %}
{% set heading = patientSession.patient.fullName %}
{% set caption = patientSession.formatted.yearGroup %}

{% block beforeContent %}
  {{ breadcrumb({
    classes: "nhsuk-breadcrumb--reverse",
    items: [{
      text: session.name,
      href: session.uri
    }, {
      text: __("session." + activity + ".label"),
      href: session.uri + "/" + activity
    } if activity]
  }) }}
{% endblock %}

{% block content %}
  {{ super() }}

  <div class="nhsuk-grid-row">
    <div class="app-grid-column-patient-record" data-module="app-sticky">
      {{ appHeading({
        classes: "nhsuk-u-margin-top-1",
        level: 3,
        size: "s",
        title: patientSession.patient.fullName
      }) }}
      {{ summaryList({
        classes: "nhsuk-u-margin-bottom-2 nhsuk-summary-list--no-border app-summary-list--full-width",
        rows: summaryRows(patient, {
          nhsn: {
            changeLabel: "the child’s NHS number",
            href: patient.uri + "/edit/nhsn" if patient.hasMissingNhsNumber
          },
          dob: {},
          address: {}
        })
      }) }}
      {{ link(patient.uri + "?referrer=" + referrer, "View full child record") | nhsukMarkdown }}
    </div>

    <div class="app-grid-column-patient-session">
      {{ appActionList({
        items: [{
          tag: statusTag(patientSession.status.instruct)
        } if session.psdProtocol and patientSession.instruct, {
          tag: statusTag(patientSession.status.register)
        } if session.registration, {
          text: __("patientSession.registration.title"),
          href: patientSession.uri + "/edit/registration?referrer=" + referrer
        } if session.registration and patientSession.register != RegistrationOutcome.Complete, {
          text: __("patientSession.record.title"),
          href: "#"
        } if not patientSession.session.isActive and patientSession.report != PatientStatus.Vaccinated]
      }) if patientSession.session.isActive }}

      {{ warningCallout({
        classes: "nhsuk-u-margin-top-3",
        heading: __mf("patientSession.outstandingVaccinations.label", {
          count: patientSession.outstandingVaccinations.length
        }),
        text: __mf("patientSession.outstandingVaccinations.message", {
          count: patientSession.outstandingVaccinations.length,
          names: patientSession.formatted.outstandingVaccinations
        })
      }) if options.showOutstandingVaccinations }}

      {% for auditEvent in patientSession.pinnedNotes %}
        {{ card({
          classes: "nhsuk-u-margin-top-2 app-card--yellow",
          heading: auditEvent.name,
          headingLevel: 4,
          feature: true,
          descriptionHtml: appEvent({ auditEvent: auditEvent, showProgrammes: true })
        }) }}
      {% endfor %}

      {% include "patient-session/_consent.njk" %}

      {% if options.canTriage %}
        {% include "patient-session/_triage.njk" %}
      {% endif %}

      {# if options.canReport#}
        {% include "patient-session/_report.njk" %}
      {# endif #}

      {% if options.canRecord %}
        {% include "patient-session/_record.njk" %}
      {% endif %}
    </div>
  </div>
{% endblock %}
