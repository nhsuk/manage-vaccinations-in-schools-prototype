{{ heading({
  level: 2,
  size: "m",
  title: __("session.triage.title")
}) }}

{% set cardDescriptionHtml %}
  {# Description #}
  {{ patientSession.status.screen.description | nhsukMarkdown }}

  {# Actions #}
  {{ button({
    classes: "app-button--secondary",
    text: __("triage.edit.title"),
    href: patientSession.uri + "/edit/triage?referrer=" + referrer
  }) if options.hasTriage }}

  {# Decision table #}
  {% set triageNoteRows = [] %}
  {% for triageNote in patientSession.triageNotes | reverse %}
    {% set triageNoteRows = triageNoteRows | push([
      {
        header: __("event.createdAt.label"),
        html: triageNote.link.createdAtAndBy
      },
      {
        header: __("event.note.label"),
        html: triageNote.note or "â€”" | nhsukMarkdown
      },
      {
        header: __("event.outcome.label"),
        html: triageNote.formatted.outcome
      }
    ]) %}
  {% endfor %}

  {% if options.hasTriage %}
    {{ actionTable({
      id: "triage-notes",
      caption: __("triage.note.label"),
      sort: "createdAt",
      responsive: true,
      head: [
        {
          text: __("event.createdAt.label"),
          attributes: {
            width: "25%"
          }
        },
        { text: __("event.note.label") },
        {
          text: __("event.outcome.label"),
          attributes: {
            width: "25%"
          }
        }
      ],
      rows: triageNoteRows
    }) }}
  {% else %}
    <hr class="nhsuk-section-break nhsuk-section-break--visible nhsuk-section-break--l">

    {{ radios({
      fieldset: {
        legend: {
          classes: "nhsuk-fieldset__legend--m",
          text: __("triage.label", { patient: patient })
        }
      },
      items: [{
        text: __("triage.outcome." + ScreenOutcome.Vaccinate),
        value: ScreenOutcome.Vaccinate
      }, {
        divider: "or"
      }, {
        text: __("triage.outcome." + ScreenOutcome.DoNotVaccinate),
        value: ScreenOutcome.DoNotVaccinate
      }, {
        text: __("triage.outcome." + ScreenOutcome.DelayVaccination),
        value: ScreenOutcome.DelayVaccination
      }, {
        text: __("triage.outcome." + ScreenOutcome.NeedsTriage),
        value: ScreenOutcome.NeedsTriage
      }],
      decorate: "triage.outcome"
    }) }}

    {{ textarea({
      label: {
        text: __("triage.note.label") + " (optional)"
      },
      rows: 5,
      decorate: "triage.note"
    }) }}

    {{ button({
      text: __("triage.confirm"),
      attributes: {
        formaction: patientSession.uri + "/new/triage?referrer=" + referrer
      }
    }) }}
  {% endif %}
{% endset %}

{{ card({
  classes: "app-card--" + patientSession.status.screen.colour,
  feature: true,
  heading: programme.name + ": " + (patientSession.status.screen.text | lower),
  headingClasses: "nhsuk-u-font-size-24",
  headingLevel: 3,
  descriptionHtml: cardDescriptionHtml
}) }}
