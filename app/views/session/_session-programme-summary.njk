{%- from "nhsuk/components/tabs/macro.njk" import tabs -%}

{% macro programmeHtml(programme) %}
  {{ appHeading({
    title: programme.name,
    level: 3,
    size: "m"
  }) }}

  <div class="nhsuk-grid-row nhsuk-card-group">
    <div class="nhsuk-grid-column-one-third nhsuk-card-group__item">
      {{ appDataCard({
        heading: PatientStatus.Due,
        headingLevel: 4,
        colour: "green",
        compact: true,
        data: session.tally(programme.id, PatientStatus.Due),
        href: session.uri + "/report?report=" + PatientStatus.Due + "&programme_id=" + programme.id
      }) }}
    </div>
    <div class="nhsuk-grid-column-one-third nhsuk-card-group__item">
      {{ appDataCard({
        heading: PatientStatus.Deferred,
        headingLevel: 4,
        colour: "red",
        compact: true,
        data: session.tally(programme.id, PatientStatus.Deferred),
        href: session.uri + "/report?report=" + PatientStatus.Deferred + "&programme_id=" + programme.id
      }) }}
    </div>
    <div class="nhsuk-grid-column-one-third nhsuk-card-group__item">
      {{ appDataCard({
        heading: PatientStatus.Vaccinated,
        headingLevel: 4,
        compact: true,
        data: session.tally(programme.id, PatientStatus.Vaccinated),
        href: session.uri + "/report?report=" + PatientStatus.Vaccinated + "&programme_id=" + programme.id
      }) }}
    </div>
  </div>
{% endmacro %}

{% set tabItems = [] %}
{% for programme in session.programmes %}
  {% set tabItems = tabItems | push({
    label: programme.name,
    id: programme.id,
    panel: {
      html: programmeHtml(programme)
    }
  }) %}
{% endfor %}

{{ tabs({
  items: tabItems
}) if session.programmes.length > 1 else programmeHtml(session.programmes[0]) }}
