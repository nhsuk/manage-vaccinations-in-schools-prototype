{% call card({
  heading: "Session in progress" if session.isActive else session.status,
  headingLevel: 3
}) %}
  {% if session.isActive or session.isCompleted %}
    {% set rows = [] %}
    {% for programme in session.programmes %}
      {% set rows = rows.concat([{
        key: {
          text: __("session.tally.vaccinatedWithVaccineCriteria.label", {
            programme: programme,
            vaccineCriteria: programme.standardVaccine.criteria
          })
        },
        value: {
          text: session.tally(programme.id, PatientStatus.Vaccinated, programme.standardVaccine.criteria)
        }
      }]) %}
      {% if programme.alternativeVaccine %}
        {% set rows = rows.concat([{
          key: {
            text: __("session.tally.vaccinatedWithVaccineCriteria.label", {
              programme: programme,
              vaccineCriteria: programme.alternativeVaccine.criteria
            })
          },
          value: {
            text: session.tally(programme.id, PatientStatus.Vaccinated, programme.alternativeVaccine.criteria)
          }
        }]) %}
      {% endif %}
    {% endfor %}

    {{ appHeading({
      classes: "nhsuk-u-margin-bottom-2",
      title: __("session.tally.vaccinated.label"),
      level: 4,
      size: "s"
    }) }}

    {{ summaryList({
      rows: rows
    }) }}
  {% else %}
    {{ session.formatted.date | nhsukMarkdown }}

    {{ session.formatted.consentWindow | nhsukMarkdown if session.type == SessionType.School }}
  {% endif %}

  {{ appButtonGroup({
    buttons: [
      {
        classes: "nhsuk-button--secondary",
        text: __("session.schedule.title") if session.isUnplanned else __("session.edit.title"),
        href: session.uri + "/edit"
      },
      {
        classes: "nhsuk-button--secondary",
        text: __("session.close.title"),
        href: session.uri + "/close"
      } if session.isCompleted
    ],
    links: [{
      classes: "nhsuk-button--secondary",
      text: __("session.offline.title"),
      href: session.uri + "/offline"
    }] if session.isPlanned
  }) }}
{% endcall %}
