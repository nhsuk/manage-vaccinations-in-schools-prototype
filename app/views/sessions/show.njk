{% extends "_layouts/default.njk" %}

{% set campaign = data.campaigns[session.campaign_uuid] %}
{% set title = campaign.name + " session at " + session.location.name %}

{% block beforeContent %}
  {{ breadcrumb({
    items: [
      {
        text: "Home",
        href: "/dashboard"
      },
      {
        text: __("session.list.title"),
        href: "/sessions"
      }
    ]
  }) }}
{% endblock %}

{% block content %}
  {{ super() }}

  {{ heading({
    classes: "nhsuk-u-margin-bottom-2",
    title: title
  }) }}

  <p class="nhsuk-caption-l nhsuk-u-margin-bottom-4">{{ session.date | govukDate }} ({{ session.time }}) Â· {{ __n("session.cohort.count", patients.length) }}</p>

  <p>
    {{ tag({
      classes: "nhsuk-tag--blue nhsuk-u-margin-right-3",
      text: session.status
    }) if session.status == SessionStatus.Active }}
    <a href="{{ session.uri }}/edit">{{ __("session.edit.title") }}</a>
  </p>

  {% set consentCardDescriptionHtml %}
    <p>
      {{ __n("consent.NoResponse.count", patients | where("consent.value", ConsentOutcome.NoResponse) | length) }}<br>
      {{ __n("consent.Given.count", patients | where("consent.value", ConsentOutcome.Given) | length) }}<br>
      {{ __n("consent.Refused.count", patients | where("consent.value", ConsentOutcome.Refused) | length) }}<br>
      {{ __n("consent.Inconsistent.count", patients | where("consent.value", ConsentOutcome.Inconsistent) | length) }}
    </p>
  {% endset %}

  <ul class="nhsuk-grid-row nhsuk-card-group">
    <li class="nhsuk-grid-column-one-half nhsuk-card-group__item">
      {{ card({
        clickable: true,
        heading: __("session.activity.consent.title"),
        headingClasses: "nhsuk-heading-m",
        href:  session.uri + "/consent",
        descriptionHtml: consentCardDescriptionHtml
      }) }}
    </li>
    <li class="nhsuk-grid-column-one-half nhsuk-card-group__item">
      {{ card({
        clickable: true,
        heading: __("session.activity.screen.title"),
        headingClasses: "nhsuk-heading-m",
        href:  session.uri + "/screen"
      }) }}
    </li>
    <li class="nhsuk-grid-column-one-half nhsuk-card-group__item">
      {{ card({
        heading: __("session.activity.capture.title"),
        headingClasses: "nhsuk-heading-m"
      }) }}
    </li>
  </ul>
{% endblock %}
