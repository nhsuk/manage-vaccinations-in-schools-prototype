{% extends "_layouts/form.njk" %}

{% set gridColumns = "full" %}
{% set type = "vaccination" if upload.type == UploadType.Report else "child" %}
{% set title = __("review.duplicate.title", type) %}
{% set confirmButtonText = __("review.duplicate.confirm") %}

{% block form %}
  {{ appHeading({
    caption: patient.fullName,
    title: title
  }) }}

  <div class="nhsuk-grid-row nhsuk-card-group">
    <div class="nhsuk-grid-column-one-half nhsuk-card-group__item">
      {% set descriptionHtml %}
        {% if upload.type == UploadType.Report %}
          {{ summaryList({
            rows: summaryRows(duplicatePatient.vaccinations[0], {
              outcome: {},
              vaccine_snomed: {},
              method: {},
              site: {},
              dose: {},
              sequence: {},
              batch: {},
              location: {},
              createdAt: {
                value: duplicateVaccination.formatted.createdAt | highlightDifference(vaccination.formatted.createdAt)
              },
              createdBy: {},
              updatedAt: {},
              protocol: {}
            })
          }) }}
        {% else %}
          {{ summaryList({
            rows: summaryRows(duplicatePatient, {
              nhsn: {},
              fullName: {},
              dob: {
                value: duplicatePatient.formatted.dob | highlightDifference(patient.formatted.dob)
              },
              gender: {},
              postalCode: {},
              school: {}
            })
          }) }}
        {% endif %}
      {% endset %}

      {{ card({
        feature: true,
        heading: __("review.duplicate.label"),
        headingClasses: "nhsuk-heading-m",
        descriptionHtml: descriptionHtml
      }) }}
    </div>
    <div class="nhsuk-grid-column-one-half nhsuk-card-group__item">
      {% set descriptionHtml %}
        {% if upload.type == UploadType.Report %}
          {{ summaryList({
            rows: summaryRows(patient.vaccinations[0], {
              outcome: {},
              vaccine_snomed: {},
              method: {},
              site: {},
              dose: {},
              sequence: {},
              batch: {},
              location: {},
              createdAt: {},
              createdBy: {},
              updatedAt: {},
              protocol: {}
            })
          }) }}
        {% else %}
          {{ summaryList({
            rows: summaryRows(patient, {
              nhsn: {},
              fullName: {},
              dob: {},
              gender: {},
              postalCode: {},
              school: {}
            })
          }) }}
        {% endif %}
      {% endset %}

      {{ card({
        feature: true,
        heading: __("review.original.label"),
        headingClasses: "nhsuk-heading-m",
        descriptionHtml: descriptionHtml
      }) }}
    </div>
  </div>

  {{ radios({
    formGroup: {
      classes: "nhsuk-u-width-one-half"
    },
    fieldset: {
      legend: {
        classes: "nhsuk-fieldset__legend--m",
        text: __("review.decision.label")
      }
    },
    items: [{
      text: __("review.decision.duplicate.label", type),
      hint: { text: __("review.decision.duplicate.hint") },
      value: "duplicate"
    }, {
      text: __("review.decision.original.label", type),
      hint: { text: __("review.decision.original.hint") },
      value: "original"
    }],
    decorate: "decision"
  }) }}
{% endblock %}
