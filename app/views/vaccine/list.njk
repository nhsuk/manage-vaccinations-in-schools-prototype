{% extends "_layouts/default.njk" %}

{% set title = __("vaccine.list.title") %}

{% block content %}
  {{ super() }}

  {{ appHeading({
    size: "xl",
    title: title
  }) }}

  {% for vaccine in vaccines %}
    {% set descriptionHtml %}
      {{ summaryList({
        rows: vaccine.getSummaryRows({
          manufacturer: {},
          snomed: {}
        })
      }) }}

      {{ button({
        classes: "nhsuk-button--secondary",
        text: __("batch.new.label"),
        href: vaccine.uri + "/batches/new"
      }) }}

      {% set batchRows = [] %}
      {% for batch in vaccine.batches | rejectattr("archivedAt") %}
        {% set tableRow = batch.getTableRow({
          id: {},
          createdAt: {},
          expiry: {}
        }) | push({
          header: __("actions.label"),
          html: appActionList({
            items: [{
              text: __("actions.change"),
              href: batch.uri + "/edit"
            }, {
              text: __("actions.archive"),
              href: batch.uri + "/archive"
            }]
          })
        }) %}
        {% set batchRows = batchRows | push(tableRow) %}
      {% endfor %}

      {{ table({
        id: "vaccines",
        responsive: true,
        head: [
          { text: __("batch.id.label") },
          { text: __("batch.createdAt.label") },
          { text: __("batch.expiry.label") },
          { text: __("actions.label") }
        ],
        rows: batchRows
      }) if batchRows.length }}
    {% endset %}

    {{ card({
      heading: vaccine.brandWithType,
      feature: true,
      headingClasses: "nhsuk-heading-m nhsuk-u-margin-bottom-1",
      href: vaccine.uri,
      descriptionHtml: descriptionHtml
    }) }}
  {% endfor %}
{% endblock %}
