{% from "school/_navigation.njk" import schoolNavigation with context %}

{% extends "_layouts/default.njk" %}

{% set title = school.name %}

{% block beforeContent %}
  {{ breadcrumb({
    items: [{
      text: __("home.show.title"),
      href: "/"
    }],
    text: __("school.list.title"),
    href: "/schools"
  }) }}
{% endblock %}

{% block content %}
  {{ super() }}

  {{ schoolNavigation({
    school: school,
    view: "show"
  }) }}

  <div class="nhsuk-grid-row nhsuk-card-group">
    <div class="nhsuk-grid-column-one-third nhsuk-card-group__item">
      {{ card({
        classes: "app-card--data app-card--reversed",
        clickable: true,
        heading: __("school.patientSessions.label"),
        headingClasses: "nhsuk-heading-xs",
        href: school.uri + "/patients",
        description: school.patientSessions.length or "0"
      }) }}
    </div>

    <div class="nhsuk-grid-column-one-third nhsuk-card-group__item">
      {{ card({
        classes: "app-card--data app-card--reversed",
        clickable: true,
        heading: __("school.sessions.label"),
        headingClasses: "nhsuk-heading-xs",
        href: school.uri + "/sessions",
        description: school.sessions.length or "0"
      }) }}
    </div>
  </div>

  {{ card({
    heading: __("school.show.summary"),
    headingClasses: "nhsuk-heading-m",
    descriptionHtml: summaryList({
      rows: summaryRows(school, {
        urn: {},
        name: {},
        phase: {},
        address: {}
      })
    })
  }) }}

  {% for yearGroup, records in school.recordsByYearGroup %}
    {% set recordRows = [] %}
    {% for record in records | sort(false, false, "createdAt") %}
      {% set recordRows = recordRows | push([
        {
          header: __("record.fullName.label"),
          text: record.fullName,
          attributes: {
            "data-col": "name"
          }
        },
        {
          header: __("record.dob.label"),
          text: record.formatted.dob
        },
        {
          header: __("record.postalCode.label"),
          text: record.postalCode
        }
      ]) %}
    {% endfor %}

    {{ details({
      classes: "nhsuk-expander",
      text: yearGroup | yearGroup + " (" + __n("school.records.count", records.length) + ")",
      HTML: actionTable({
        tableClasses: "nhsuk-u-margin-0",
        id: "records",
        sort: "name",
        head: [
          {
            text: __("record.fullName.label"),
            attributes: {
              style: "width: 50%"
            }
          },
          { text: __("record.dob.label") },
          { text: __("record.postalCode.label") }
        ],
        rows: recordRows
      })
    }) }}
  {% endfor %}
{% endblock %}
